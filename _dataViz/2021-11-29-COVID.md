---
title: "Cal COVID Cases by County"
tags: epidemiology dataviz rank python matplotlib pandas
article_header:
  type: overlay
  theme: dark
  background_image:
    gradient: 'linear-gradient(135deg, rgba(0, 0, 0 , .4), rgba(0, 0, 0, .4))'
    src: /media/covid/calRank.png
cover: /media/covid/thumb.png
---


<!--more-->

# Intro

# Dev

## Constants and Load Data

First, we setup the paths, some constants that will be useful in the analysis, and read our data file:

```python
(WIN_W, WIN_M, PERS) = (30, 30, 1e3)
(PT_ROT, FNAME) = (
    '/home/chipdelmal/Documents/COVID/', 
    'covid19cases_test.csv'
)
invalid = {'Out of state', 'Unknown'}
rawDF = pd.read_csv(path.join(PT_ROT, FNAME))
```

## Cleaning DataFrame

```python
countyDF = rawDF[rawDF['area_type']=='County'].drop('area_type', axis=1)
countyDF['date'] = pd.to_datetime(countyDF['date'], format='%Y-%m-%d')
counties = set(countyDF['area'].unique())-invalid
countyDF = countyDF[countyDF['area'].isin(counties)]
```

## Pivots

```python
countyDF['casesByPop'] = PERS * (countyDF['cases'] / countyDF['population'])
countyDFPiv = countyDF.pivot(index='area', columns='date', values='casesByPop')
countyDFPiv = countyDFPiv.reset_index().set_index('area')
countyDFPiv = countyDFPiv.drop(countyDFPiv.columns[0], axis=1)
```

## Rolling Averages

```python
rolling = countyDFPiv.rolling(window=WIN_W, axis=1, min_periods=WIN_M).mean()
ranks = rolling.rank(ascending=True, method='first', axis=0)
dates = list(ranks.columns)
ranksPiv = ranks.reset_index().melt('area')
rollingPiv = rolling.reset_index().melt('area')
```

## Plots

<center>
    <img width="100%" src="/media/covid/calRank.png">
    <img width="100%" src="/media/covid/calRolling.png">
</center>


# Code Repo

* **Repository:** [Github repo](https://github.com/Chipdelmal/COVID_viz)
